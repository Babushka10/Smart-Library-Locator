#include <Arduino.h>
#include <string.h>

int i=3;
char bookshelf[10][18];
int shelfno[10];
int availability[10];

void addbook()
{
  Serial.println("enter the name of the book:");
  String adbook = readSerialString();
  strcpy(bookshelf[i+1],adbook.c_str());
  Serial.println("enter the shelf of the book:(1-4)");
  int sh = readSerialString().toInt();
  shelfno[i+1]=sh;
  availability[i+1]=1;
  i=i+1;
}

void takebook()
{
  Serial.println("enter the name of the book to be taken:");
  char c[18];
   String rembook=readSerialString();
   strcpy(c,rembook.c_str());
   Serial.println(c);
   int len=strlen(c);
  int ctr=0;
  for(int j=0;j<(i+1);j++)
  {
    if(strncmp(bookshelf[j],c,len)==0)
    {
      strcpy(bookshelf[j],"");
      availability[j]=0;
      ctr=1;
    }
  }
   if(ctr==0)
   {
    Serial.println("Error 404: book not found");
   }
}
void showlib()
{ Serial.print("Bookname");
  Serial.print("      -       ");
  Serial.print("is available?(y=1/n=0)");
  Serial.println("");
  for(int k=0;k<i+1;k++)
  {
   Serial.print(bookshelf[k]);
  Serial.print("      -       ");
  Serial.print(availability[k]);
  Serial.println("");
  }
}
void disco()
{
   Serial.flush();
   Serial.println("enter the name of the book to be located:");
   String str=readSerialString();
   delay(1000);
   Serial.println(str);
   int t=0;
   for(int j=0;j<(i+1);j++)
  { Serial.println(strcmp(str.c_str(),bookshelf[j]));
    if(strcmp(str.c_str(),bookshelf[j])==0)
    { if(availability[j]!=0)
       {
        digitalWrite(shelfno[j]+2,HIGH);
        delay(3000);
        digitalWrite(shelfno[j]+2,LOW);
        t=1;
       }
    }
  }
  
  if(t==0)
  {
      Serial.println("Error 404: book not found");
      digitalWrite(13,HIGH);
      delay(3000);
      digitalWrite(13,LOW);
  }
  
}

String readSerialString() {
    String input = "";

    while (!Serial.available()) {
        delay(10);
    }

    while (Serial.available()) {
        char c = Serial.read();
        if (c == '\n') {
            break;
        }
        input += c;
    }

    delay(10);
    while (Serial.available()) {
        Serial.read();
    }

    return input;
}

void setup() {
    Serial.begin(9600);
    pinMode(3, OUTPUT);
    pinMode(4, OUTPUT);
    pinMode(5, OUTPUT);
    pinMode(6, OUTPUT);
    pinMode(13, OUTPUT);


    // Initialize book data
strcpy(bookshelf[0],"mc");
strcpy(bookshelf[1],"ch");
strcpy(bookshelf[2],"la");
strcpy(bookshelf[3],"dr");

shelfno[0]=1;
shelfno[1]=2;
shelfno[2]=3;
shelfno[3]=4;


availability[0]=1;
availability[1]=0;
availability[2]=1;
availability[3]=1;
}


void loop()
{
  int choice=0;
  Serial.println("\nAvailable options are:");
  Serial.println("1)Locate a book\n2)Add a book\n3)Take a book\n4)Show Library\n5)TERMINATE PROTOCOL\n");
  Serial.println("Enter your choice: ");
  choice = readSerialString().toInt();
  if (choice==1)
  {
    disco();
  }
  else if (choice==2)
  {
    addbook();
  }
  else if (choice==3)
  {
    takebook();
  }
  else if (choice==4)
  {
    showlib();
  }
  else if (choice==5)
  {
    Serial.print("Terminating program...");
    delay(3000);
    exit(0);
  }
  else 
  {
    Serial.println("Incorrect choice( 1-5 ONLY)");
  }
}